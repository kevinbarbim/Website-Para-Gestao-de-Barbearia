CREATE DATABASE bd_TCC;
USE bd_TCC;

CREATE TABLE tb_Cliente 
( 
 id_Cliente INT PRIMARY KEY AUTO_INCREMENT,  
 Nome_Cliente VARCHAR(20) NOT NULL,
 Telefone_Cliente VARCHAR(16) NOT NULL,  
 Sobrenome_Cliente VARCHAR(20) NOT NULL,  
 Email_Cliente VARCHAR(30) NOT NULL
); 


CREATE TABLE tb_Funcionario 
( 
 nome VARCHAR(100) NOT NULL,
  path VARCHAR(100) NOT NULL DEFAULT '../../arquivos/pfp.png',
   data_upload DATETIME DEFAULT CURRENT_TIMESTAMP, 
 id_Funcionario INT PRIMARY KEY AUTO_INCREMENT,  
 Nome_Funcionario VARCHAR(40) NOT NULL,  
 Telefone_Funcionario VARCHAR(16) NOT NULL unique,  
 CPF_Funcionario VARCHAR(20) NOT NULL,  
 RG_Funcionario VARCHAR(20) NOT NULL,  
 Tipo_Funcionario INT NOT NULL DEFAULT '0',  
 Data_Entrada DATE NOT NULL,  
 Data_Saida DATE,  
 Login VARCHAR(40) NOT NULL UNIQUE,  
 Senha VARCHAR(20) NOT NULL,  
 Status INT NOT NULL DEFAULT '1'
); 

SELECT * FROM tb_funcionario;

CREATE TABLE tb_Produto 
( 
 id_Produto INT PRIMARY KEY AUTO_INCREMENT,  
 Nome_Produto VARCHAR(30) NOT NULL unique,  
 Quantidade_Estoque INT NOT NULL,  
 Valor_Unitario FLOAT NOT NULL,  
 Descricao_Produto VARCHAR(300),
 Status INT NOT NULL DEFAULT '1'
); 

SELECT * FROM tb_Produto;

CREATE TABLE tb_Servico 
( 
 id_Servico INT PRIMARY KEY AUTO_INCREMENT,  
 cod_Funcionario INT,  
 cod_Cliente INT,  
 Metodo_Pagamento VARCHAR(15) NOT NULL,  
 Data_Servico DATE NOT NULL,  
 Horario_Servico time NOT NULL,  
 Valor_Total FLOAT NOT NULL,  
 Descricao_Corte VARCHAR(200) NOT NULL,
 tags VARCHAR(200),  
 Status INT NOT NULL  DEFAULT '1'
);

SELECT * FROM tb_servico;
CREATE TABLE tb_Venda_Produto 
( 
 id_Venda_Produto INT PRIMARY KEY AUTO_INCREMENT,  
 cod_Produto INT,  
 cod_Servico INT,  
 Quantidade_Produto INT NOT NULL,
 valor_parcial float
); 

ALTER TABLE tb_Servico ADD FOREIGN KEY(cod_Funcionario) REFERENCES tb_Funcionario (id_Funcionario);
ALTER TABLE tb_Servico ADD FOREIGN KEY(cod_Cliente) REFERENCES tb_Cliente (id_Cliente);
ALTER TABLE tb_Venda_Produto ADD FOREIGN KEY(cod_Produto) REFERENCES tb_Produto (id_Produto);
ALTER TABLE tb_Venda_Produto ADD FOREIGN KEY(cod_Servico) REFERENCES tb_Servico (id_Servico);


/*inserts*/

INSERT INTO tb_produto (Nome_Produto,Quantidade_Estoque,Valor_Unitario)
VALUES ('gel de cabelo',12,22.50),
      ('pente',145,2.50),
      ('escova',6,4.00);


INSERT INTO tb_cliente (Nome_Cliente,Telefone_Cliente,Sobrenome_Cliente,Email_Cliente)
         VALUES ('maria', '33333333333','clara','maria@gmail.com'),
         ('thiago', '44444444444','simas','thiago@gmail.com'),
         ('valeria', '55555555555','almeida','valeria@gmail.com');
         
         
         
/*Ã© pra dar aviso, pois os atributos da imagem ainda nao estao concretizados*/         
INSERT INTO tb_funcionario (Nome_Funcionario,Telefone_Funcionario,CPF_Funcionario,RG_Funcionario,Tipo_Funcionario,Data_Entrada,Login,Senha)
          VALUES ('ADM', '44444444444','444444','44444444','1','2006/05/31','ADM@gmail.com','123'),
                ('FUNCIONARIO', '555555555','555555','55555','0','2006/05/31','FUNCIONARIO@gmail.com','123'),
                ('andersson', '6666666','666666','666666','0','2006/05/31','andersson@gmail.com','123');
                
                
INSERT INTO tb_servico (cod_Funcionario, cod_Cliente, Metodo_Pagamento, Data_Servico, Horario_Servico, Valor_Total, Descricao_Corte)
            VALUES (1,1,'pix','2024/05/21','12:35:00',255.25,'corte simples'),
            (2,2,'pix','2024/05/21','12:35:00',255.25,'corte simples'),
            (3,3,'pix','2024/05/21','12:35:00',255.25,'corte simples');
            
INSERT INTO tb_venda_produto (cod_Produto, cod_Servico, Quantidade_Produto)
         VALUES (1,1,2),
         (2,1,10),
         (3,2,3),
         (1,3,5),
         (2,3,1),
         (3,3,20);
   
   
SELECT * FROM tb_funcionario;
         
/*select para descobrir quais e quantos itens fazem parte do pedido (o que o cliente comprou) no servico de id 3*/
SELECT p.nome_produto, i.quantidade_produto, n.nome_cliente, s.id_servico, f.nome_funcionario FROM 
tb_produto p JOIN tb_venda_produto i ON (cod_produto=id_produto)
JOIN tb_servico s ON (cod_servico=id_servico)
JOIN tb_cliente n ON (cod_cliente=id_cliente)
JOIN tb_funcionario f ON(cod_funcionario=id_funcionario)
WHERE id_servico=3;


SELECT * FROM tb_funcionario WHERE nome_funcionario LIKE '%a%';
SELECT * FROM tb_servico;
SELECT * FROM tb_cliente;
 
SELECT s.*, c.nome_cliente
FROM tb_servico s JOIN tb_cliente c
ON (cod_cliente=id_cliente)
WHERE id_Servico;


/*select de exemplo para saber se o funcionario x tem algum servico marcado no dia y e no horario z*/
SELECT f.nome_funcionario
FROM tb_funcionario f
JOIN tb_servico s ON(cod_funcionario=id_funcionario)
WHERE Data_Servico = '24/05/31' AND horario_servico = '11:11:0' AND nome_funcionario = 'andersson';

 /*pedir pra camila analisar amanha*/
 /*codio de historico do estoque*/
 SELECT p.nome_produto, s.data_servico, v.quantidade_produto, f.nome_funcionario, c.nome_cliente
 FROM tb_produto p 
 JOIN tb_venda_produto v      ON (cod_produto = id_produto)
 JOIN tb_servico s            ON (cod_servico = id_servico)
 JOIN tb_funcionario f        ON (cod_funcionario = id_funcionario)
 JOIN tb_cliente c            ON (cod_cliente = id_cliente) ORDER BY data_servico desc;
 


SELECT * FROM tb_produto;
SELECT * FROM tb_venda_produto;

SELECT s.*, c.Nome_Cliente
FROM tb_servico s JOIN tb_cliente c
ON (cod_cliente=id_cliente)
WHERE id_Servico ='6';
